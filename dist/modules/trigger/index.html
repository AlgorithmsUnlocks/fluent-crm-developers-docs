<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Trigger | FluentCRM Developers</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/favicon.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/assets/img/logo.svg" color="#7742e6">
    <link rel="apple-touch-icon" href="/assets/img/logo.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,500;0,700;1,300;1,500;1,700&amp;display=auto">
    <meta name="description" content="Resources and tutorials for FluentCRM developers">
    <meta name="theme-color" content="#7742e6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/img/icon.svg">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.6c970851.css" as="style"><link rel="preload" href="/assets/js/app.54af8faa.js" as="script"><link rel="preload" href="/assets/js/4.202d7228.js" as="script"><link rel="preload" href="/assets/js/78.ebb6457f.js" as="script"><link rel="preload" href="/assets/js/5.36d7588c.js" as="script"><link rel="prefetch" href="/assets/js/1.ccc50939.js"><link rel="prefetch" href="/assets/js/10.a93ee020.js"><link rel="prefetch" href="/assets/js/11.6de29fb5.js"><link rel="prefetch" href="/assets/js/12.8bb2c031.js"><link rel="prefetch" href="/assets/js/13.8b90f23a.js"><link rel="prefetch" href="/assets/js/14.fe783837.js"><link rel="prefetch" href="/assets/js/15.b92236f9.js"><link rel="prefetch" href="/assets/js/16.c05916cc.js"><link rel="prefetch" href="/assets/js/17.d43d02a0.js"><link rel="prefetch" href="/assets/js/18.3533050d.js"><link rel="prefetch" href="/assets/js/19.027ffb1b.js"><link rel="prefetch" href="/assets/js/20.32ea98ef.js"><link rel="prefetch" href="/assets/js/21.78e59a6b.js"><link rel="prefetch" href="/assets/js/22.82643910.js"><link rel="prefetch" href="/assets/js/23.5118c40d.js"><link rel="prefetch" href="/assets/js/24.7d372983.js"><link rel="prefetch" href="/assets/js/25.0bdb77f4.js"><link rel="prefetch" href="/assets/js/26.c32c3ff9.js"><link rel="prefetch" href="/assets/js/27.044ab364.js"><link rel="prefetch" href="/assets/js/28.3b913a8e.js"><link rel="prefetch" href="/assets/js/29.504c4933.js"><link rel="prefetch" href="/assets/js/30.0464ba36.js"><link rel="prefetch" href="/assets/js/31.3231bcf1.js"><link rel="prefetch" href="/assets/js/32.62bf3865.js"><link rel="prefetch" href="/assets/js/33.7c677f9d.js"><link rel="prefetch" href="/assets/js/34.78fc7f36.js"><link rel="prefetch" href="/assets/js/35.abc2a4bb.js"><link rel="prefetch" href="/assets/js/36.b2d45da2.js"><link rel="prefetch" href="/assets/js/37.10e05bfc.js"><link rel="prefetch" href="/assets/js/38.67de45a5.js"><link rel="prefetch" href="/assets/js/39.02647e0c.js"><link rel="prefetch" href="/assets/js/40.f6d5ebcf.js"><link rel="prefetch" href="/assets/js/41.b93e1d1c.js"><link rel="prefetch" href="/assets/js/42.3613ef44.js"><link rel="prefetch" href="/assets/js/43.a3e3a2b2.js"><link rel="prefetch" href="/assets/js/44.6c1d679f.js"><link rel="prefetch" href="/assets/js/45.caa29800.js"><link rel="prefetch" href="/assets/js/46.b05d1d62.js"><link rel="prefetch" href="/assets/js/47.8a57019c.js"><link rel="prefetch" href="/assets/js/48.cf65302a.js"><link rel="prefetch" href="/assets/js/49.bc869897.js"><link rel="prefetch" href="/assets/js/50.74233c86.js"><link rel="prefetch" href="/assets/js/51.4092c465.js"><link rel="prefetch" href="/assets/js/52.e0648eb3.js"><link rel="prefetch" href="/assets/js/53.36094df0.js"><link rel="prefetch" href="/assets/js/54.e1c05629.js"><link rel="prefetch" href="/assets/js/55.bbd54bbb.js"><link rel="prefetch" href="/assets/js/56.1fb2a423.js"><link rel="prefetch" href="/assets/js/57.22199256.js"><link rel="prefetch" href="/assets/js/58.7eb15f0c.js"><link rel="prefetch" href="/assets/js/59.c3612d84.js"><link rel="prefetch" href="/assets/js/6.25d6c35f.js"><link rel="prefetch" href="/assets/js/60.018202f2.js"><link rel="prefetch" href="/assets/js/61.a92bd38c.js"><link rel="prefetch" href="/assets/js/62.c7d01b92.js"><link rel="prefetch" href="/assets/js/63.e1481903.js"><link rel="prefetch" href="/assets/js/64.b40f70c8.js"><link rel="prefetch" href="/assets/js/65.7ccf9ed5.js"><link rel="prefetch" href="/assets/js/66.9286d4d1.js"><link rel="prefetch" href="/assets/js/67.c20526c6.js"><link rel="prefetch" href="/assets/js/68.fe196dcb.js"><link rel="prefetch" href="/assets/js/69.21684ea4.js"><link rel="prefetch" href="/assets/js/7.28dee799.js"><link rel="prefetch" href="/assets/js/70.15c0a79d.js"><link rel="prefetch" href="/assets/js/71.841dedc1.js"><link rel="prefetch" href="/assets/js/72.3cb42c08.js"><link rel="prefetch" href="/assets/js/73.23e90daf.js"><link rel="prefetch" href="/assets/js/74.0656a71e.js"><link rel="prefetch" href="/assets/js/75.52e77de1.js"><link rel="prefetch" href="/assets/js/76.b14e2b95.js"><link rel="prefetch" href="/assets/js/77.8e45f1ab.js"><link rel="prefetch" href="/assets/js/79.24736f95.js"><link rel="prefetch" href="/assets/js/8.a42d882d.js"><link rel="prefetch" href="/assets/js/9.58f3ec84.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.e9e545df.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6c970851.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/icon.svg" alt="FluentCRM Developers" class="logo"> <span class="site-name can-hide">FluentCRM Developers</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><span class="title">Database</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database" class="mobile-dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">
  Database Schema
</a></li><li class="dropdown-item"><!----> <a href="/database/models/" class="nav-link">
  Database Models
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developer Hooks" class="dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developer Hooks" class="mobile-dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hooks/actions/" class="nav-link">
  Action Hooks
</a></li><li class="dropdown-item"><!----> <a href="/hooks/filters/" class="nav-link">
  Filter Hooks
</a></li><li class="dropdown-item"><!----> <a href="/global-functions/" class="nav-link">
  Global Functions
</a></li><li class="dropdown-item"><!----> <a href="/helpers/" class="nav-link">
  Helpers Classes
</a></li><li class="dropdown-item"><!----> <a href="/cli/" class="nav-link">
  CLI
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Modules" class="dropdown-title"><span class="title">Modules</span> <span class="arrow down"></span></button> <button type="button" aria-label="Modules" class="mobile-dropdown-title"><span class="title">Modules</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/modules/automation/" class="nav-link">
  Automation
</a></li><li class="dropdown-item"><!----> <a href="/modules/smart-code/" class="nav-link">
  Smart Codes
</a></li><li class="dropdown-item"><!----> <a href="/modules/contact-profile-section/" class="nav-link">
  Contact's Profile
</a></li><li class="dropdown-item"><!----> <a href="/extending-rest-api/" class="nav-link">
  Extending REST API
</a></li></ul></div></div><div class="nav-item"><a href="https://fluentcrm.com/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://rest-api.fluentcrm.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  REST API
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/fluentcrm/fluent-crm-developers-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><span class="title">Database</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database" class="mobile-dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">
  Database Schema
</a></li><li class="dropdown-item"><!----> <a href="/database/models/" class="nav-link">
  Database Models
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developer Hooks" class="dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developer Hooks" class="mobile-dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hooks/actions/" class="nav-link">
  Action Hooks
</a></li><li class="dropdown-item"><!----> <a href="/hooks/filters/" class="nav-link">
  Filter Hooks
</a></li><li class="dropdown-item"><!----> <a href="/global-functions/" class="nav-link">
  Global Functions
</a></li><li class="dropdown-item"><!----> <a href="/helpers/" class="nav-link">
  Helpers Classes
</a></li><li class="dropdown-item"><!----> <a href="/cli/" class="nav-link">
  CLI
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Modules" class="dropdown-title"><span class="title">Modules</span> <span class="arrow down"></span></button> <button type="button" aria-label="Modules" class="mobile-dropdown-title"><span class="title">Modules</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/modules/automation/" class="nav-link">
  Automation
</a></li><li class="dropdown-item"><!----> <a href="/modules/smart-code/" class="nav-link">
  Smart Codes
</a></li><li class="dropdown-item"><!----> <a href="/modules/contact-profile-section/" class="nav-link">
  Contact's Profile
</a></li><li class="dropdown-item"><!----> <a href="/extending-rest-api/" class="nav-link">
  Extending REST API
</a></li></ul></div></div><div class="nav-item"><a href="https://fluentcrm.com/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://rest-api.fluentcrm.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  REST API
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/fluentcrm/fluent-crm-developers-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Automation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/modules/automation/" class="sidebar-link">Getting Started</a></li><li><a href="/modules/trigger/" aria-current="page" class="active sidebar-link">Trigger </a></li><li><a href="/modules/action/" class="sidebar-link">Action </a></li><li><a href="/modules/benchmark/" class="sidebar-link">Benchmark </a></li><li><a href="/modules/form-field-code-structure/" class="sidebar-link">Form Field Code Structure</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Smart Codes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/modules/smart-code/" class="sidebar-link">Smart Code</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Contact Profile Section</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/modules/contact-profile-section/" class="sidebar-link">Contact Profile Section</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="trigger"><a href="#trigger" class="header-anchor">#</a> Trigger</h1> <p>An event or action that initiates a specific automated response, that is what we call a trigger.
For example, when a user subscribes to a newsletter, this action is considered a trigger.
A trigger is the foundation of any automation process, it starts the series of actions that follows. The trigger is the first step of automation.</p> <h2 id="creating-a-trigger"><a href="#creating-a-trigger" class="header-anchor">#</a> Creating a Trigger</h2> <p>Say, you are providing some courses on your plugin. You would like to trigger workflows when a user enrols to a course.
You can use the <code>course-enrolled</code> trigger to do that.
Create a class that extends <code>FluentCrm\App\Services\Funnel\BaseTrigger</code> class.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">Your<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>Name<span class="token punctuation">\</span>Automation</span><span class="token punctuation">;</span>
<span class="token operator">...</span> 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>Funnel<span class="token punctuation">\</span>BaseTrigger</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">CourseEnrolledTrigger</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTrigger</span> <span class="token punctuation">{</span>


<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>We need to override the default constructor method to set the trigger's properties.
Constructor of the class should have the following body:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">triggerName</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'course-enrolled'</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">priority</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">actionArgNum</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The <code>triggerName</code> property is the name of the event that will trigger this workflow. For our case, let's name it <code>course-enrolled</code>.
The <code>priority</code> property is the priority of the action that will be added to the <code>add_action</code> function.
The <code>actionArgNum</code> property is the number of arguments that will be passed to the callback.
Finally, we need to call the parent constructor.</p> <p>Now, we need to define getTrigger method. This method should return an array of the trigger settings.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'category'</span>    <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Awesome Course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'User enroll in a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'description'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'The will start when a student enroll a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span>
        <span class="token string single-quoted-string">'icon'</span>        <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'fc-icon-wp_new_user_signup'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Define the <code>getFunnelSettingsDefaults</code> method. This method should return an array of the default settings for the workflow.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFunnelSettingsDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'subscription_status'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'subscribed'</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Define the <code>getSettingsFields</code> method. This method should return an array of the settings fields that will be displayed in the workflow settings page.
You can customize settings as desired . Visit <a href="/modules/form-field-code-structure.html">Form Field Code Structure</a> for more information.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getSettingsFields</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'title'</span>     <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'User enroll in a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'sub_title'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This will start when a student enroll a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'fields'</span>    <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'subscription_status'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'type'</span>        <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'option_selectors'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'option_key'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'editable_statuses'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'is_multiple'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Subscription Status'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'placeholder'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Select Status'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>There should be an option to select the particular courses for which the workflow should be triggered.
This can be done by adding <code>getConditionFields</code> method.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getConditionFields</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$courseOptions</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'id'</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'2'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Think like a pro in JavaScript'</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'id'</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'3'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Master in wordpress plugin development'</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'update_type'</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'type'</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'radio'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'label'</span>   <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'If Contact Already Exist?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'help'</span>    <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Please specify what will happen if the subscriber already exist in the database'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'options'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">getUpdateOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'course_ids'</span>   <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'type'</span>        <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'multi-select'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Target Courses'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'help'</span>        <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Select for which Courses this automation will run'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'options'</span>     <span class="token operator">=&gt;</span> <span class="token variable">$courseOptions</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'inline_help'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Keep it blank to run to any Course Enrollment'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'run_multiple'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'type'</span>        <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'yes_no_check'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'check_label'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Restart the Automation Multiple times for a contact for this event. (Only enable if you want to restart automation for the same contact)'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fluentcampaign-pro'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'inline_help'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'If you enable, then it will restart the automation for a contact if the contact already in the automation. Otherwise, It will just skip if already exist'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fluentcampaign-pro'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>Let's populate some default values for condition fields with <code>getConditionDefaults</code> method.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getConditionDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'update_type'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'update'</span><span class="token punctuation">,</span> <span class="token comment">// skip_all_actions, skip_update_if_exist</span>
        <span class="token string single-quoted-string">'course_ids'</span>   <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'run_multiple'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'no'</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The <code>handle</code> method needs to be defined in order for it to be called when the trigger event occurs. We are almost finished with this process.
The method takes two arguments. The first argument is the funnel object and second argument is the array of the arguments that are passed to the callback.
Note that, we must prepare subscriber data.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// ... </span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$originalArgs</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// separate the arguments</span>
    <span class="token variable">$enrollmentReference</span> <span class="token operator">=</span> <span class="token variable">$originalArgs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$courseId</span> <span class="token operator">=</span> <span class="token variable">$originalArgs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$userId</span> <span class="token operator">=</span> <span class="token variable">$originalArgs</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// get the funnel settings and conditions</span>
    <span class="token variable">$settings</span> <span class="token operator">=</span> <span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">settings</span><span class="token punctuation">;</span>
    <span class="token variable">$conditions</span> <span class="token operator">=</span> <span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">conditions</span><span class="token punctuation">;</span>
    
    <span class="token comment">// prepare the subscriber data</span>
    <span class="token variable">$subscriberData</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token comment">// required</span>
        <span class="token string single-quoted-string">'first_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'last_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token variable">$settings</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'subscription_status'</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// or, you may use the FluentCRM helper function to prepare the subscriber data</span>
    <span class="token variable">$subscriberData</span> <span class="token operator">=</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">prepareUserData</span><span class="token punctuation">(</span><span class="token variable">$userId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// check if this funnel is able to process this course and run the automation</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">isProcessable</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$courseId</span><span class="token punctuation">,</span> <span class="token variable">$subscriberData</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// finally start funnel sequence for this subscriber</span>
    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>Funnel<span class="token punctuation">\</span>FunnelProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">startFunnelSequence</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$subscriberData</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'source_trigger_name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">triggerName</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'source_ref_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$courseId</span> <span class="token comment">// optional</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// ...</span>
<span class="token comment">// check if this funnel is able to process this course and run the automation</span>
<span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">isProcessable</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$courseId</span><span class="token punctuation">,</span> <span class="token variable">$subscriberData</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$conditions</span> <span class="token operator">=</span> <span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">conditions</span><span class="token punctuation">;</span>
    <span class="token comment">// check update_type</span>
    <span class="token variable">$updateType</span> <span class="token operator">=</span> <span class="token class-name static-context">Arr</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$conditions</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'update_type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$subscriber</span> <span class="token operator">=</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">getSubscriber</span><span class="token punctuation">(</span><span class="token variable">$subscriberData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$subscriber</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$updateType</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'skip_all_if_exist'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// check the products ids</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$conditions</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'course_ids'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$courseId</span><span class="token punctuation">,</span> <span class="token variable">$conditions</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'course_ids'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     <span class="token comment">// check run_only_one</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$subscriber</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">ifAlreadyInFunnel</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token variable">$subscriber</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$multipleRun</span> <span class="token operator">=</span> <span class="token class-name static-context">Arr</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$conditions</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run_multiple'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$multipleRun</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">removeSubscribersFromFunnel</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$subscriber</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>Everything is set and ready to go. Let's look at the full source code.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">Your<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>Name<span class="token punctuation">\</span>Automation</span><span class="token punctuation">;</span>
<span class="token operator">...</span> 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>Funnel<span class="token punctuation">\</span>BaseTrigger</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>Funnel<span class="token punctuation">\</span>FunnelHelper</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Arr</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>Funnel<span class="token punctuation">\</span>FunnelProcessor</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">CourseEnrolledTrigger</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTrigger</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">triggerName</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'course-enrolled'</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">priority</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">actionArgNum</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'category'</span>    <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Awesome Course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'User enroll in a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'description'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'The will start when a student enroll a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span>
            <span class="token string single-quoted-string">'icon'</span>        <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'fc-icon-wp_new_user_signup'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFunnelSettingsDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'subscription_status'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'subscribed'</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getSettingsFields</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'title'</span>     <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'User enroll in a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sub_title'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This will start when a student enroll a course'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'fields'</span>    <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'subscription_status'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'type'</span>        <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'option_selectors'</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'option_key'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'editable_statuses'</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'is_multiple'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Subscription Status'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'placeholder'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Select Status'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getConditionFields</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$courseOptions</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'id'</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'2'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Think like a pro in JavaScript'</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'id'</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'3'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Master in wordpress plugin development'</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'update_type'</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'type'</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'radio'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'label'</span>   <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'If Contact Already Exist?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'help'</span>    <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Please specify what will happen if the subscriber already exist in the database'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'options'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">getUpdateOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'course_ids'</span>   <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'type'</span>        <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'multi-select'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Target Courses'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'help'</span>        <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Select for which Courses this automation will run'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'options'</span>     <span class="token operator">=&gt;</span> <span class="token variable">$courseOptions</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'inline_help'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Keep it blank to run to any Course Enrollment'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'your-plugin'</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'run_multiple'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'type'</span>        <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'yes_no_check'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'label'</span>       <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'check_label'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Restart the Automation Multiple times for a contact for this event. (Only enable if you want to restart automation for the same contact)'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fluentcampaign-pro'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'inline_help'</span> <span class="token operator">=&gt;</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'If you enable, then it will restart the automation for a contact if the contact already in the automation. Otherwise, It will just skip if already exist'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fluentcampaign-pro'</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getConditionDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'update_type'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'update'</span><span class="token punctuation">,</span> <span class="token comment">// skip_all_actions, skip_update_if_exist</span>
            <span class="token string single-quoted-string">'course_ids'</span>   <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'run_multiple'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'no'</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$originalArgs</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// separate the arguments</span>
        <span class="token variable">$enrollmentReference</span> <span class="token operator">=</span> <span class="token variable">$originalArgs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$courseId</span> <span class="token operator">=</span> <span class="token variable">$originalArgs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$userId</span> <span class="token operator">=</span> <span class="token variable">$originalArgs</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
        <span class="token comment">// get the funnel settings and conditions</span>
        <span class="token variable">$settings</span> <span class="token operator">=</span> <span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">settings</span><span class="token punctuation">;</span>
        <span class="token variable">$conditions</span> <span class="token operator">=</span> <span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">conditions</span><span class="token punctuation">;</span>
        
        <span class="token comment">// prepare the subscriber data</span>
        <span class="token variable">$subscriberData</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token comment">// required</span>
            <span class="token string single-quoted-string">'first_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'last_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token variable">$settings</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'subscription_status'</span><span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// you may use the helper function to prepare the subscriber data</span>
        <span class="token variable">$subscriberData</span> <span class="token operator">=</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">prepareUserData</span><span class="token punctuation">(</span><span class="token variable">$userId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token comment">// check if this funnel is able to process this course and run the automation</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">isProcessable</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$courseId</span><span class="token punctuation">,</span> <span class="token variable">$subscriberData</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// finally start funnel sequence for this subscriber</span>
        <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>Funnel<span class="token punctuation">\</span>FunnelProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">startFunnelSequence</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$subscriberData</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'source_trigger_name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">triggerName</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'source_ref_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$courseId</span> <span class="token comment">// optional</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// check if this funnel is able to process this course and run the automation</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">isProcessable</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token punctuation">,</span> <span class="token variable">$courseId</span><span class="token punctuation">,</span> <span class="token variable">$subscriberData</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$conditions</span> <span class="token operator">=</span> <span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">conditions</span><span class="token punctuation">;</span>
        <span class="token comment">// check update_type</span>
        <span class="token variable">$updateType</span> <span class="token operator">=</span> <span class="token class-name static-context">Arr</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$conditions</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'update_type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$subscriber</span> <span class="token operator">=</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">getSubscriber</span><span class="token punctuation">(</span><span class="token variable">$subscriberData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$subscriber</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$updateType</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'skip_all_if_exist'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// check the products ids</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$conditions</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'course_ids'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$courseId</span><span class="token punctuation">,</span> <span class="token variable">$conditions</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'course_ids'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
         <span class="token comment">// check run_only_one</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$subscriber</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">ifAlreadyInFunnel</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token variable">$subscriber</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$multipleRun</span> <span class="token operator">=</span> <span class="token class-name static-context">Arr</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$conditions</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run_multiple'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'yes'</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$multipleRun</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name static-context">FunnelHelper</span><span class="token operator">::</span><span class="token function">removeSubscribersFromFunnel</span><span class="token punctuation">(</span><span class="token variable">$funnel</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$subscriber</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br></div></div><h2 id="registering-the-trigger"><a href="#registering-the-trigger" class="header-anchor">#</a> Registering the Trigger</h2> <p>All set! Your trigger is ready to use.
Call the class to register the workflow.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fluentcrm_loaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Your<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>Name<span class="token punctuation">\</span>Automation<span class="token punctuation">\</span>CourseEnrolledTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/fluentcrm/fluent-crm-developers-docs/edit/master/src/modules/trigger.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/10/2023, 4:51:00 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/modules/automation/" class="prev">
        Getting Started
      </a></span> <span class="next"><a href="/modules/action/">
        Action 
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.54af8faa.js" defer></script><script src="/assets/js/4.202d7228.js" defer></script><script src="/assets/js/78.ebb6457f.js" defer></script><script src="/assets/js/5.36d7588c.js" defer></script>
  </body>
</html>
